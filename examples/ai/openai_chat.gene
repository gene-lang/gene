#!/usr/bin/env gene run

# Example: call OpenAI-compatible chat endpoint using the native
# `OpenAIClient` class registered by the VM. Reads API configuration
# from environment variables and falls back to OpenAI defaults.

(var api_key   ($env .get "OPENAI_API_KEY"))
(var base_url  ($env .get "OPENAI_API_BASE" "https://api.openai.com/v1"))
(var model     ($env .get "OPENAI_API_MODEL" "gpt-5-mini"))

(var client_config
  (if api_key
    then {^api_key api_key ^base_url base_url ^model model}
    else {^base_url base_url ^model model}))

(var client (new OpenAIClient client_config))

(var messages
  [
    {^role "system" ^content "You are a friendly assistant."}
    {^role "user"   ^content "Say hi in one short sentence."}
  ])
   
(var response (client .chat {^messages messages}))
(println response)
