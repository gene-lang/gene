# Demonstrates the LLM pipeline backed by genex/llm.
# Set GENE_LLM_MODEL to a real GGUF path for true inference,
# or build Gene with -d:GENE_LLM_MOCK to exercise the mock backend.

(import genex/llm)

(var env_model ($env "GENE_LLM_MODEL"))
(var model_path (if env_model env_model "./tests/fixtures/llm/mock-model.gguf"))
(var load_opts
  (if env_model
    {}
    {^allow_missing true ^context 512 ^threads 2}))

(var model
  (genex/llm/load_model model_path load_opts))

(var session
  (model .new_session {^max_tokens 8 ^temperature 0.6}))

(var response
  (session .infer
    "Write a short greeting from the Gene VM."
    {^max_tokens 5}))

(println "Mock LLM response map:")
(println response)
